import{i as x,d as S}from"./importCode-b2326f94.js";import V from"./view-ea541b4e.js";import{_ as T,r as d,o as b,d as F,a as e,w as l,F as A,g as h,b as c,c as $,f as j}from"./index-65c3e508.js";const z={name:"console",components:{importCode:x,viewCode:V},data(){return{mode:!1,viewCodeStatus:!1,importCodeStatus:!1,importing:0,dialogTableImport:!1,form:{genId:void 0},apiObj:this.$API.gen.table.list,tableApi:this.$API.gen.table.table,importColumnApi:this.$API.gen.table.importColumn,selectionImport:[],selection:[],downloadForm:{}}},created(){this.form.genId=this.$route.params.genId,(!this.form.genId||this.form.genId==="null")&&delete this.form.genId},methods:{openEdit(t){this.$router.push({path:"/console/edit/"+t.tabId+"/"+t.genId})},async openSync(t){const o=this,r=t.tabName;this.$confirm('确认要强制同步"'+r+'"表结构吗？',"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return o.$API.gen.table.sync.get({tabId:t.tabId})}).then(()=>{o.msgSuccess("同步成功")}).catch(()=>{})},batchDelete(){if(!this.selection||this.selection.length==0){this.$message.error("请选择表");return}const t=[];for(const o of this.selection)t.push(o.tabId);this.table_del({tabId:t.join(",")})},openDownFile(t){this.openGen(t,!0),S(this.$API.gen.table.batchGenCode.url,this.downloadForm,"code")},openView(t){this.viewCodeStatus=!0,this.$refs.viewCodeRef.open(t)},openGen(t,o){this.downloadForm={};var r=null;const p=[];if(t)r=t.tabId,p.push(t.tabName);else if(!this.selection||this.selection.length==0){this.$message.error("请选择表");return}else{const n=[];for(const i of this.selection)n.push(i.tabId),p.push(i.tabName);r=n.join(",")}this.downloadForm.tabIds=r,this.downloadForm.tableNames=p,console.log(this.downloadForm),o||this.$refs.importCodeRef.open(this.downloadForm)},async table_del(t){var o={tableId:t.tabId},r=await this.$API.gen.table.delete.delete(o);r.code=="00000"?this.$refs.table1.refresh():this.$notify.error({title:"提示",message:r.msg})},async refresh(){this.$refs.table1.reload(this.form)},async submitImport(){if(!this.selectionImport||this.selectionImport.length==0){this.$message.error("请选择表");return}this.importing=!0;var t=[];for(const p of this.selectionImport)t.push(p.tableName);const o={};Object.assign(o,this.form),o.tableName=t;const r=await this.importColumnApi.imports(o);r.code=="00000"?(this.dialogTableImport=!1,this.$notify.success({title:"提示",message:"导入成功"}),this.$refs.table1.refresh()):this.$notify.error({title:"提示",message:r.msg})},selectionImportChange(t){this.selectionImport=t},selectionChange(t){this.selection=t},importColumn(){this.active=0,this.importing=0,this.dialogTableImport=!0}}},B={class:"left-panel"},O={class:"right-panel"},D={class:"right-panel-search"};function P(t,o,r,p,n,i){const m=d("el-button"),g=d("el-input"),_=d("el-header"),s=d("el-table-column"),C=d("el-popconfirm"),w=d("el-button-group"),u=d("scTable"),y=d("el-main"),I=d("el-container"),v=d("el-dialog"),k=d("import-code"),N=d("view-code");return b(),F(A,null,[e(I,null,{default:l(()=>[e(_,null,{default:l(()=>[h("div",B,[e(m,{type:"primary",icon:"el-icon-refresh",onClick:i.importColumn},{default:l(()=>[c("导入")]),_:1},8,["onClick"]),e(m,{plain:"",type:"primary",icon:"el-icon-download",onClick:o[0]||(o[0]=a=>i.openGen(null,!1))},{default:l(()=>[c("生成")]),_:1}),e(m,{type:"danger",icon:"el-icon-delete",onClick:i.batchDelete},null,8,["onClick"])]),h("div",O,[h("div",D,[e(g,{modelValue:n.form.keyword,"onUpdate:modelValue":o[1]||(o[1]=a=>n.form.keyword=a),placeholder:"表名",clearable:""},null,8,["modelValue"]),e(m,{type:"primary",icon:"el-icon-search",onClick:i.refresh},null,8,["onClick"])])])]),_:1}),e(y,{class:"nopadding"},{default:l(()=>[e(u,{ref:"table1",params:n.form,apiObj:n.apiObj,"row-key":"id",onSelectionChange:i.selectionChange,stripe:""},{default:l(()=>[e(s,{type:"selection",width:"50"}),e(s,{label:"#",type:"index",width:"50"}),e(s,{label:"数据源名称",prop:"genName",width:"150"}),e(s,{label:"表名",prop:"tabName",width:"200"}),e(s,{label:"实体",prop:"tabClassName"}),e(s,{label:"业务名",prop:"tabBusinessName"}),e(s,{label:"模块名",prop:"tabModuleName"}),e(s,{label:"描述",prop:"tabDesc"}),e(s,{label:"备注",prop:"tabRemark"}),e(s,{label:"操作",fixed:"right",width:"370"},{default:l(a=>[e(w,null,{default:l(()=>[e(m,{text:"",icon:"el-icon-view",type:"primary",size:"small",onClick:f=>i.openView(a.row,!1)},{default:l(()=>[c("预览")]),_:2},1032,["onClick"]),e(m,{text:"",icon:"el-icon-edit",type:"primary",size:"small",onClick:f=>i.openEdit(a.row,!1)},{default:l(()=>[c("编辑")]),_:2},1032,["onClick"]),a.row.genType!=="SYSTEM"?(b(),$(C,{key:0,title:"确定删除吗？",onConfirm:f=>i.table_del(a.row,a.$index)},{reference:l(()=>[e(m,{icon:"el-icon-delete",text:"",type:"primary",size:"small"},{default:l(()=>[c("删除")]),_:1})]),_:2},1032,["onConfirm"])):j("v-if",!0),e(m,{text:"",icon:"el-icon-refresh",type:"primary",size:"small",onClick:f=>i.openSync(a.row,!1)},{default:l(()=>[c("同步")]),_:2},1032,["onClick"]),e(m,{text:"",icon:"el-icon-office-building",type:"primary",size:"small",onClick:f=>i.openGen(a.row,!1)},{default:l(()=>[c("生成代码")]),_:2},1032,["onClick"]),e(m,{text:"",icon:"el-icon-download",type:"primary",size:"small",onClick:f=>i.openDownFile(a.row)},{default:l(()=>[c("下载")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["params","apiObj","onSelectionChange"])]),_:1})]),_:1}),e(v,{title:"导入",modelValue:n.dialogTableImport,"onUpdate:modelValue":o[4]||(o[4]=a=>n.dialogTableImport=a),"close-on-click-modal":!1,width:"70%","destroy-on-close":"",onClosed:o[5]||(o[5]=a=>t.$emit("closed")),draggable:""},{footer:l(()=>[e(m,{onClick:o[2]||(o[2]=a=>n.dialogTableImport=!1)},{default:l(()=>[c("取 消")]),_:1}),e(m,{modelValue:n.mode,type:"primary",loading:n.importing,onClick:o[3]||(o[3]=a=>i.submitImport())},{default:l(()=>[c("导入")]),_:1},8,["modelValue","loading"])]),default:l(()=>[e(u,{ref:"table",pageSize:10,apiObj:n.tableApi,params:n.form,"row-key":"id",onSelectionChange:i.selectionImportChange,stripe:""},{default:l(()=>[e(s,{type:"selection",width:"50"}),e(s,{label:"#",type:"index",width:"50"}),e(s,{label:"数据库",prop:"database",width:"150"}),e(s,{label:"表名",prop:"tableName",width:"350"}),e(s,{label:"描述",prop:"remark",width:"200"})]),_:1},8,["apiObj","params","onSelectionChange"])]),_:1},8,["modelValue"]),e(k,{ref:"importCodeRef","v-model":n.importCodeStatus},null,8,["v-model"]),e(N,{ref:"viewCodeRef","v-model":n.viewCodeStatus},null,8,["v-model"])],64)}const M=T(z,[["render",P],["__file","Z:/workspace/vue-support-parent-starter/vue-support-gen-starter/src/views/gen/console/index.vue"]]);export{M as default};
