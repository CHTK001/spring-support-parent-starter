# spring-support-pay-client-starter 缺陷分析

## 缺陷清单

| 序号 | 缺陷类型 | 严重程度 | 位置 | 问题描述 | 状态 |
|------|---------|---------|------|---------|------|
| 1 | 编译错误 | 高 | PayMerchantFailureRecord | 缺少 setCreateTime/setUpdateTime 方法 | 已修复 |
| 2 | 编译错误 | 高 | PayMerchantOrderWater | 缺少 getCreateTime 方法 | 已修复 |
| 3 | 编译错误 | 高 | PayMerchantFailureRecord | 缺少 getCreateTime 方法 | 已修复 |
| 4 | 编译错误 | 高 | PayMerchantOrder | 缺少 getCreateTime 方法 | 已修复 |
| 5 | 编译错误 | 高 | PayMerchantTransferRecord | 缺少 setCreateTime 方法 | 已修复 |
| 6 | 代码警告 | 中 | PayMerchant | Lombok equals/hashCode 警告 | 已修复 |
| 7 | 代码警告 | 低 | WechatJsApiCreateSignAdaptor | 使用了过时的 API | 待修复 |

## 详细说明

### 缺陷 1-5: 实体类缺少时间字段的 getter/setter 方法

**问题分析**:
- 所有相关实体类都继承了 `SysBase` 基类
- `SysBase` 基类中定义了 `createTime` 和 `updateTime` 字段（类型为 `LocalDateTime`）
- 实体类使用了 `@Data` 注解，理论上应该自动生成 getter/setter 方法
- 但编译时提示找不到这些方法

**影响范围**:
1. `WebchatCallbackNotificationParser.java:157-158` - 调用 `setCreateTime` 和 `setUpdateTime`
2. `WebchatCallbackPaymentPointsNotificationParser.java:158-159` - 调用 `setCreateTime` 和 `setUpdateTime`
3. `WebchatCallbackRefundNotificationParser.java:161-162` - 调用 `setCreateTime` 和 `setUpdateTime`
4. `WebchatCallbackTransferNotificationParser.java:138-139` - 调用 `setCreateTime` 和 `setUpdateTime`
5. `PayMerchantOrderController.java:65` - 调用 `PayMerchantOrderWater::getCreateTime`
6. `PayMerchantOrderController.java:79` - 调用 `PayMerchantFailureRecord::getCreateTime`
7. `PayMerchantOrderServiceImpl.java:288` - 调用 `PayMerchantOrder::getCreateTime`
8. `WechatBillsTransferBillsAdaptor.java:217` - 调用 `setCreateTime`

**可能原因**:
1. Lombok 配置问题，导致继承的字段没有生成 getter/setter
2. 实体类中可能有字段覆盖或冲突
3. 编译顺序问题，基类未正确编译

**修复建议**:
1. 检查 Lombok 配置是否正确
2. 确认实体类是否正确继承了 `SysBase`
3. 如果 Lombok 无法生成，可以手动添加 getter/setter 方法
4. 或者检查是否需要添加 `@Getter` 和 `@Setter` 注解

### 缺陷 6: PayMerchant 类 Lombok 警告

**位置**: `PayMerchant.java:23`

**问题**: 
```
Generating equals/hashCode implementation but without a call to superclass, even though this class does not extend java.lang.Object.
```

**修复方案**: 
在 `PayMerchant` 类上添加 `@EqualsAndHashCode(callSuper = false)` 注解，或者如果确实需要调用父类方法，则添加 `@EqualsAndHashCode(callSuper = true)`

### 缺陷 7: 使用过时的 API

**位置**: `WechatJsApiCreateSignAdaptor.java`

**问题**: 使用了已过时的 API

**修复方案**: 检查代码，替换为新的 API

## 修复优先级

1. **高优先级**: 缺陷 1-5（编译错误，阻止项目编译）
2. **中优先级**: 缺陷 6（代码警告，影响代码质量）
3. **低优先级**: 缺陷 7（过时 API，不影响功能但需要更新）

