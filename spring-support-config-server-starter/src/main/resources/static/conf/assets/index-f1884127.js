import{_ as E,m as F,r as l,a as z,o as i,g as v,w as d,b as s,d as c,c as r,t as _,e as f,j as O,l as y,n as R,q as A,p as H,k as P}from"./index-85936978.js";import{A as w,e as U}from"./ansi_up-43bcf599.js";import{s as j}from"./index-36862cfe.js";const B=F(()=>R(()=>import("./index-1b04d195.js"),["./index-1b04d195.js","./index-85936978.js","./index-eff5854e.css","./index-deaa83c3.css"],import.meta.url)),D=new w,K={name:"UniformLog",components:{scCodeEditor:B,scSelectFilter:j},data(){return{showStack:{},input:"",dialog:0,selectedValues:{},selectedValuesItem:[{title:"模块",key:"module",multiple:!1,options:[]}],showFile:0,data:[],detail:void 0,defaultProps:{children:"children",label:"ex"},eventSource:null}},updated(){this.$refs.containerRef.scrollTop=this.$refs.containerRef.scrollHeight},mounted(){this.initial(),this.change({module:""})},beforeUnmount(){if(this.eventSource)try{this.eventSource.close()}catch{}},created(){var e=this;document.onkeydown=function(o){window.event.keyCode==113&&(e.showFile=!0,e.input="",e.nextTick(()=>{e.$refs.input.focus()}))}},methods:{change(e){this.selectedValues=e,this.subscribe((this.selectedValues.module||"trace")=="trace"?"trace":"trace"+this.selectedValues.module)},async initial(){const e=await this.$API.config.actuator.applications.get();if(e.code==="00000"&&this.selectedValuesItem[0].options.length==0){this.selectedValuesItem[0].options.push({label:"全部",value:""});for(const o of e.data)this.selectedValuesItem[0].options.push({label:o,value:o})}},showTrack(e){return this.dialog=!this.dialog,this.detail=e,0},enterQuery(){this.$API.config.search.get({keyword:this.input}).then(e=>{e.code==="00000"&&(this.data.length=0,this.data=e.data.map(o=>D.ansi_to_html(o==null?void 0:o.message)),this.showFile=0)})},subscribe:function(e){const o=this;if(new w,this.eventSource)try{this.eventSource.close()}catch{}this.eventSource=new U.EventSourcePolyfill(this.$API.config.uniform.url+e),this.eventSource.addEventListener(e,u=>{let t=JSON.parse(u.data).message;t=t.substring(t.indexOf("[trace]")+7),t=JSON.parse(t),console.log2(t),this.data.push(t[0]),this.data.length>1e4&&this.data.shift(),this.$nextTick(()=>{let h=this.$refs.containerRef;h.scrollTo({top:h.scrollHeight,behavior:"smooth"})})}),this.eventSource.onerror=function(u){},this.eventSource.onopen=function(u){o.$notify.success({title:"提示",dangerouslyUseHTMLString:!0,message:"订阅成功"})}}}},m=e=>(H("data-v-b51cdf89"),e=e(),P(),e),q={class:"left-panel"},J=m(()=>c("br",null,null,-1)),Q=["title"],Z={key:0},G={key:1},W=["innerHTML"],X=["innerHTML"],Y={key:2},$=m(()=>c("span",null,null,-1)),ee=["onClick"],te=m(()=>c("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64zm67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344zM590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296-44.096 0-108.992 44.736-148.48 101.504 0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04 67.84 0 107.904-43.648 147.456-100.416z"},null,-1)),oe=[te],ne={class:"demo-drawer__content"},se={key:0},le={key:0},ie={key:1};function ce(e,o,u,k,t,h){const x=l("sc-select-filter"),M=l("el-header"),g=l("el-tag"),b=l("el-tree"),p=l("highlightjs"),S=l("el-drawer"),V=l("el-button"),C=l("el-input"),T=l("el-dialog"),I=l("el-main"),L=l("el-container"),N=z("time");return i(),v(L,null,{default:d(()=>[s(M,null,{default:d(()=>[c("div",q,[s(x,{data:t.selectedValuesItem,"selected-values":t.selectedValues,"label-width":80,onOnChange:h.change},null,8,["data","selected-values","onOnChange"]),J])]),_:1}),s(I,null,{default:d(()=>[c("div",{ref:"containerRef",style:{height:"100%",overflow:"auto"},onKeyup:o[0]||(o[0]=y((...a)=>e.keyEvent&&e.keyEvent(...a),["native"]))},[s(b,{data:t.data,props:t.defaultProps,onNodeClick:e.handleNodeClick},{default:d(({node:a,data:n})=>[c("span",{class:"custom-tree-node",title:n.title},[n.id==n.linkId?(i(),r("span",Z,[c("span",null,"Http "+_(n.ex??n.message),1)])):(i(),r("span",G,[c("span",null,[(n.message||"").indexOf("span")>-1?(i(),r("span",{key:0,innerHTML:n.ex??n.message},null,8,W)):(n.typeMethod||"").indexOf("span")>-1||(n.typeMethod||"").indexOf("el-tag")>-1?(i(),r("span",{key:1,innerHTML:n.typeMethod},null,8,X)):(i(),r("span",Y,_(n.typeMethod),1))]),$])),f(" @"),O(s(g,{style:{height:"26px"}},null,512),[[N,n==null?void 0:n.enterTime]]),f(" 耗时: "),s(g,{style:{height:"26px"}},{default:d(()=>[f(_(n==null?void 0:n.costTime)+" ms",1)]),_:2},1024),c("span",null,[(i(),r("svg",{style:{height:"14px","z-index":"20230819"},onClick:A(ae=>h.showTrack(n),["stop"]),viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg","data-v-ea893728":""},oe,8,ee))])],8,Q)]),_:1},8,["data","props","onNodeClick"])],544),s(S,{size:"40%",ref:"drawerRef",modelValue:t.dialog,"onUpdate:modelValue":o[1]||(o[1]=a=>t.dialog=a),direction:"rtl",class:"demo-drawer","destroy-on-close":!0},{default:d(()=>[c("div",ne,[t.detail.header?(i(),r("div",se,[t.detail.model!="sql"?(i(),r("div",le,[s(p,{language:"yaml",autodetect:!1,code:t.detail.header.join(`\r
`),style:{"font-size":"14px","font-weight":"800","font-family":"ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace"}},null,8,["code"])])):(i(),v(p,{key:1,language:"Sql",autodetect:!1,code:t.detail.header[0],style:{"font-size":"14px","font-weight":"800","font-family":"ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace"}},null,8,["code"]))])):(i(),r("div",ie,[s(p,{language:"java",autodetect:!1,code:t.detail.stack.join(`\r
`),style:{"font-size":"14px","font-weight":"800","font-family":"ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace"}},null,8,["code"])]))])]),_:1},8,["modelValue"]),s(V,{type:"primary",icon:"el-icon-search",style:{position:"fixed",right:"0",top:"50%",width:"40px",height:"40px"},onClick:o[2]||(o[2]=a=>t.showFile=!0)}),s(T,{draggable:"",modelValue:t.showFile,"onUpdate:modelValue":o[4]||(o[4]=a=>t.showFile=a)},{default:d(()=>[s(C,{ref:"input",modelValue:t.input,"onUpdate:modelValue":o[3]||(o[3]=a=>t.input=a),placeholder:"搜索",size:"large",clearable:"","prefix-icon":"el-icon-search",onKeyup:y(h.enterQuery,["enter"]),"trigger-on-focus":!1},null,8,["modelValue","onKeyup"])]),_:1},8,["modelValue"])]),_:1})]),_:1})}const he=E(K,[["render",ce],["__scopeId","data-v-b51cdf89"],["__file","Z:/works/vue-support-parent-starter/vue-support-config-starter/src/views/config/trace/index.vue"]]);export{he as default};
