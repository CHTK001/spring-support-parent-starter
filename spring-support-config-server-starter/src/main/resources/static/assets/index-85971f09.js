import{s as H}from"./index-49c4323e.js";import M from"./logger-cccd682a.js";import q from"./env-b56294e1.js";import G from"./configprops-21970ced.js";import{_ as Z,r as a,a as J,o as i,c as w,b as t,w as o,d as s,e as p,F as P,f as K,g as r,h as f,t as g,i as C,j as Q,p as R,k as W}from"./index-a5e257d7.js";const X={name:"tableBase",components:{scSelectFilter:H,logger:M,env:q,configprops:G},data(){return{refreshTime:1e4,showConfigpropsDialog:0,showLoggerDialog:0,showEnvDialog:0,listData:[],statusFilters:[{text:"启用",value:0},{text:"禁用",value:1}],form:{mapMethod:[],pageSize:20},total:0,visible:0,searchParams:{},data:[{title:"环境",key:"appProfile",multiple:!1,options:[{label:"全部",value:""}]}],row:{},profiles:[],applications:[],list:{apiObj:this.$API.config.actuator.page,apiObjUpdate:this.$API.config.actuator.update,apiObjSave:this.$API.config.actuator.save,apiObjDelete:this.$API.config.actuator.delete,apiCommand:this.$API.config.actuator.command},selection:[],timer:null}},mounted(){this.initial(),this.doSearch()},watch:{refreshTime:{deep:!0,immediate:!0,handler(){this.loopTask()}}},beforeUnmount(){clearInterval(this.timer),this.timer=null},created(){this.loopTask(),Notification.requestPermission()},methods:{loopTask(){clearInterval(this.timer),this.timer=null,this.timer=window.setInterval(()=>{setTimeout(()=>{for(const e of this.listData)this.refreshState(e)},0)},this.refreshTime)},refreshState(e,n){n&&(e.stateState="loading"),this.list.apiCommand.get({dataId:e.appId,command:"health",method:"GET",isOtherServer:!0}).then(d=>{if(d.code==="00000")return d.data.status=="UP"?(e.stateState=="offline"&&new Notification(e.appName+"上线了"),e.stateState="online"):(e.stateState=="online"&&new Notification(e.appName+"下线了"),e.stateState="offline"),0;e.stateState=="online"&&new Notification(e.appName+"下线了"),e.stateState="offline"}).catch(()=>{e.stateState="offline"})},openLog(e){this.showLoggerDialog=1,this.$nextTick(()=>{this.$refs.loggerDialog.open(e)})},openEnv(e){this.showEnvDialog=1,this.$nextTick(()=>{this.$refs.envDialog.open(e)})},openConfigprops(e){this.showConfigpropsDialog=1,this.$nextTick(()=>{this.$refs.configpropsDialog.open(e)})},openOshi(e){this.$router.push({path:"/config/actuator/oshi/"+e.appId})},selectionChange(e){this.selection=e},doSearch(){this.list.apiObj.get(this.form).then(e=>{if(e.code==="00000"){this.listData=e.data.data;for(const n of this.listData)this.refreshState(n);this.total=e.data.total}})},async initial(){const e=await this.$API.config.actuator.profile.get();e.code==="00000"&&(this.profiles=e.data,e.data.forEach(d=>{this.data[0].options.push({label:d,value:d})}));const n=await this.$API.config.actuator.applications.get();n.code==="00000"&&(this.applications=n.data)},submitFormUpdate(e){this.list.apiObjSave.post(e||this.row).then(n=>{if(n.code==="00000")return this.$message.success("操作成功"),this.search(),this.visible=!1,0;this.$message.error(n.msg)})},filterHandler(e,n,d){const S=d.property;return n[S]===e},change(e){this.searchParams=e,this.form.profile=e.appProfile,this.doSearch()}}},v=e=>(R("data-v-af92cc53"),e=e(),W(),e),Y={class:"left-panel"},ee=v(()=>s("br",null,null,-1)),te={class:"right-panel"},oe={style:{position:"relative"}},ae=["onClick"],le=v(()=>s("h4",null,"应用端口",-1)),ne=v(()=>s("h4",null,"应用前缀",-1)),se={class:"bottom"},ie=v(()=>s("div",{class:"state"},null,-1)),ce={class:"handler"};function re(e,n,d,S,c,h){const I=a("sc-select-filter"),u=a("el-button"),_=a("el-option"),x=a("el-select"),T=a("el-header"),y=a("el-tag"),k=a("el-icon"),b=a("el-col"),D=a("el-row"),N=a("el-dropdown-item"),O=a("el-dropdown-menu"),$=a("el-dropdown"),A=a("el-card"),E=a("el-main"),V=a("scPagintion"),j=a("el-footer"),L=a("el-container"),U=a("logger"),B=a("env"),F=a("configprops"),z=J("role");return i(),w(P,null,[t(L,null,{default:o(()=>[t(T,null,{default:o(()=>[s("div",Y,[t(I,{data:c.data,"selected-values":e.selectedValues,"label-width":80,onOnChange:h.change},null,8,["data","selected-values","onOnChange"]),ee]),s("div",te,[t(u,{type:"primary",icon:"el-icon-search",onClick:e.search},null,8,["onClick"]),t(u,{type:"primary",icon:"el-icon-plus",onClick:n[0]||(n[0]=l=>e.table_edit({}))}),t(u,{type:"danger",plain:"",icon:"el-icon-delete",disabled:c.selection.length==0,onClick:e.batch_del},null,8,["disabled","onClick"]),t(x,{modelValue:c.refreshTime,"onUpdate:modelValue":n[1]||(n[1]=l=>c.refreshTime=l),placeholder:"刷新频率"},{default:o(()=>[t(_,{value:1e4,label:"10s"},{default:o(()=>[p("10s")]),_:1}),t(_,{value:2e4,label:"20s"},{default:o(()=>[p("20s")]),_:1}),t(_,{value:3e4,label:"30s"},{default:o(()=>[p("30s")]),_:1}),t(_,{value:4e4,label:"40s"},{default:o(()=>[p("40s")]),_:1}),t(_,{value:5e4,label:"50s"},{default:o(()=>[p("50s")]),_:1}),t(_,{value:6e4,label:"60s"},{default:o(()=>[p("60s")]),_:1})]),_:1},8,["modelValue"])])]),_:1}),t(E,null,{default:o(()=>[t(D,{gutter:15},{default:o(()=>[(i(!0),w(P,null,K(c.listData,l=>(i(),r(b,{xl:6,lg:6,md:8,sm:12,xs:24,key:l.appId,class:"demo-progress"},{default:o(()=>[t(A,{class:"task task-item",shadow:"hover"},{default:o(()=>[s("h2",oe,[f(' <sc-status-indicator pulse type="success"></sc-status-indicator> '),s("span",null,g(l.appName),1),t(y,null,{default:o(()=>[p(g(l.appProfile),1)]),_:2},1024),s("span",{class:"state1",onClick:m=>h.refreshState(l,!0)},[l.stateState=="online"?(i(),r(k,{key:0,title:"在线"},{default:o(()=>[(i(),r(C("sc-icon-online"),{circle:""}))]),_:1})):f("v-if",!0),l.stateState=="loading"?(i(),r(k,{key:1,class:"animation",title:"加载中"},{default:o(()=>[(i(),r(C("sc-icon-loading-v2"),{circle:""}))]),_:1})):f("v-if",!0),l.stateState=="offline"?(i(),r(k,{key:2,title:"离线"},{default:o(()=>[(i(),r(C("sc-icon-lan-disconnection"),{circle:""}))]),_:1})):f("v-if",!0)],8,ae)]),t(D,null,{default:o(()=>[t(b,{span:24},{default:o(()=>[s("ul",null,[s("li",null,[le,s("p",null,[t(y,null,{default:o(()=>[p(g(l.appHost)+":"+g(l.appSpringPort),1)]),_:2},1024)])]),s("li",null,[ne,s("p",null,g(l.appContextPath),1)])])]),_:2},1024)]),_:2},1024),Q((i(),w("div",se,[ie,s("div",ce,[t(u,{type:"primary",icon:"sc-icon-line",title:"CPU",circle:"",plain:"",onClick:m=>h.openOshi(l)},null,8,["onClick"]),t(u,{type:"primary",icon:"sc-icon-config",title:"环境",circle:"",plain:"",onClick:m=>h.openEnv(l)},null,8,["onClick"]),t(u,{type:"primary",icon:"el-icon-setting",title:"配置",circle:"",plain:"",onClick:m=>h.openConfigprops(l)},null,8,["onClick"]),t($,{trigger:"click"},{dropdown:o(()=>[t(O,null,{default:o(()=>[t(N,{onClick:m=>h.openLog(l)},{default:o(()=>[p("日志")]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[t(u,{type:"primary",icon:"el-icon-more",circle:"",plain:""})]),_:2},1024)])])),[[z,["ADMIN","OPS"]]])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(j,{style:{height:"51px","line-height":"50px",padding:"0"}},{default:o(()=>[t(V,{pageSize:c.form.pageSize,total:c.total,onDataChange:h.doSearch},null,8,["pageSize","total","onDataChange"])]),_:1})]),_:1}),c.showLoggerDialog?(i(),r(U,{key:0,ref:"loggerDialog"},null,512)):f("v-if",!0),c.showEnvDialog?(i(),r(B,{key:1,ref:"envDialog"},null,512)):f("v-if",!0),c.showConfigpropsDialog?(i(),r(F,{key:2,ref:"configpropsDialog"},null,512)):f("v-if",!0)],64)}const _e=Z(X,[["render",re],["__scopeId","data-v-af92cc53"],["__file","Z:/works/vue-support-parent-starter/vue-support-config-starter/src/views/config/actuator/index.vue"]]);export{_e as default};
