import{A as m,e as S}from"./ansi_up-362f87df.js";import{s as x}from"./index-49c4323e.js";import{_ as F,r as s,o as c,g as d,w as u,b as l,d as r,c as p,f as I,F as C,h as E,l as f}from"./index-a5e257d7.js";const T=new m,A={name:"UniformLog",components:{scSelectFilter:x},data(){return{input:"",showFile:0,data:[],selectedValues:{},selectedValuesItem:[{title:"模块",key:"module",multiple:!1,options:[]}],eventSource:null}},updated(){this.$refs.containerRef.scrollTop=this.$refs.containerRef.scrollHeight},mounted(){this.initial(),this.change({module:""})},beforeUnmount(){if(this.eventSource)try{this.eventSource.close()}catch{}},created(){var e=this;document.onkeydown=function(t){window.event.keyCode==113&&(e.showFile=!0,e.input="",e.nextTick(()=>{e.$refs.input.focus()}))}},methods:{change(e){this.selectedValues=e,this.subscribe((this.selectedValues.module||"log")=="log"?"log":"log"+this.selectedValues.module)},async initial(){const e=await this.$API.config.actuator.applications.get();if(e.code==="00000"&&this.selectedValuesItem[0].options.length==0){this.selectedValuesItem[0].options.push({label:"全部",value:""});for(const t of e.data)this.selectedValuesItem[0].options.push({label:t,value:t})}},enterQuery(){this.$API.config.search.get({keyword:this.input}).then(e=>{e.code==="00000"&&(this.data.length=0,this.data=e.data.map(t=>T.ansi_to_html(t==null?void 0:t.message)),this.showFile=0)})},subscribe:function(e){const t=this;var h=new m;if(this.eventSource)try{this.eventSource.close()}catch{}this.eventSource=new S.EventSourcePolyfill(this.$API.config.uniform.url+e),this.eventSource.addEventListener(e,i=>{const n=JSON.parse(i.data);this.data.push(h.ansi_to_html(n.message).replaceAll(`
`,"<br/>")),this.data.length>1e4&&this.data.shift(),this.$nextTick(()=>{let a=this.$refs.containerRef;a.scrollTo({top:a.scrollHeight,behavior:"smooth"})})}),this.eventSource.onerror=function(i){},this.eventSource.onopen=function(i){t.$notify.success({title:"提示",dangerouslyUseHTMLString:!0,message:"订阅成功"})}}}},L={class:"left-panel"},U=r("br",null,null,-1),H=["innerHTML"];function B(e,t,h,i,n,a){const _=s("sc-select-filter"),g=s("el-header"),v=s("el-empty"),y=s("el-button"),w=s("el-input"),V=s("el-dialog"),k=s("el-main"),b=s("el-container");return c(),d(b,null,{default:u(()=>[l(g,null,{default:u(()=>[r("div",L,[l(_,{data:n.selectedValuesItem,"selected-values":n.selectedValues,"label-width":80,onOnChange:a.change},null,8,["data","selected-values","onOnChange"]),U])]),_:1}),l(k,null,{default:u(()=>[r("div",{ref:"containerRef",style:{height:"100%",overflow:"auto"},onKeyup:t[0]||(t[0]=f((...o)=>e.keyEvent&&e.keyEvent(...o),["native"]))},[r("ul",null,[(c(!0),p(C,null,I(n.data,o=>(c(),p("li",null,[r("span",{innerHTML:o},null,8,H)]))),256))]),!n.data||n.data.length==0?(c(),d(v,{key:0})):E("v-if",!0)],544),l(y,{type:"primary",icon:"el-icon-search",style:{position:"fixed",right:"0",top:"50%",width:"40px",height:"40px"},onClick:t[1]||(t[1]=o=>n.showFile=!0)}),l(V,{draggable:"",modelValue:n.showFile,"onUpdate:modelValue":t[3]||(t[3]=o=>n.showFile=o)},{default:u(()=>[l(w,{ref:"input",modelValue:n.input,"onUpdate:modelValue":t[2]||(t[2]=o=>n.input=o),placeholder:"搜索",size:"large",clearable:"","prefix-icon":"el-icon-search",onKeyup:f(a.enterQuery,["enter"]),"trigger-on-focus":!1},null,8,["modelValue","onKeyup"])]),_:1},8,["modelValue"])]),_:1})]),_:1})}const R=F(A,[["render",B],["__file","Z:/works/vue-support-parent-starter/vue-support-config-starter/src/views/config/log/index.vue"]]);export{R as default};
