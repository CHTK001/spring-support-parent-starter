# AI 模块缺陷清单

## 缺陷统计
| 序号 | 模块 | 缺陷类型 | 描述 | 状态 |
|------|------|----------|------|------|
| 1 | AiClient | 命名不当 | Spring 模块的 AiClient 只做人脸识别，应命名为 FaceClient | ✅ 已修复 |
| 2 | ChatClient | 重复定义 | Spring 模块重新定义了简化版 ChatClient，应直接使用 utils 模块实现 | ✅ 已修复 |
| 3 | IdentificationEngine | 命名不当 | Spring 模块的 IdentificationEngine 只做人脸识别，命名误导 | ✅ 已修复 |
| 4 | DefaultAiClient | 职责混乱 | Spring 模块 DefaultAiClient 依赖自定义 IdentificationEngine | ✅ 已修复 |

## 修复内容

### 1. AiClient → FaceClient
- 已存在 `FaceClient` 接口，删除冗余的 `AiClient` 接口
- 更新 `FaceClient` 接口方法签名，使用 `byte[]` 和 `File` 作为参数
- 删除文件: `AiClient.java`, `DefaultAiClient.java`

### 2. IdentificationEngine → FaceEngine
- 创建新接口 `FaceEngine`，专门用于人脸识别功能
- 创建实现类 `AiChatFaceEngine`
- 更新 `DefaultFaceClient` 使用 `FaceEngine`
- 更新 `AiConfiguration` 注册新 Bean
- 删除文件: `IdentificationEngine.java`, `AiChatIdentificationEngine.java`

### 3. ChatClient 统一
- Spring 模块 `ChatClient` 继承 utils 模块 `ChatClient`
- `McpChatClient` 适配新接口，委托给 utils 模块实现
- 保留 Spring 层的上下文适配功能

## 知识图谱功能分析

**结论: 设计合理，无需修改**

- `MemoryMcpPostprocessor`: 通过正则提取实体和关系，存储到知识图谱，设计合理
- `AbstractRagService`: RAG 服务基类，集成知识库和聊天客户端，流程清晰

## 修复进度

- [x] 重命名 AiClient → FaceClient
- [x] 重命名 IdentificationEngine → FaceEngine
- [x] 统一 ChatClient 使用 utils 模块实现
- [x] 更新所有引用
- [ ] 编译验证
