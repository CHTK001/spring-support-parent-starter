import{s as H}from"./index-4d05358e.js";import{_ as W,r as a,a as L,o as s,c as v,b as o,w as t,d as C,e as m,t as U,g as c,j as _,h as V,F as y,f as j,v as M}from"./index-56cdd313.js";const Z={name:"tableBase",components:{scSelectFilter:H},data(){return{statusFilters:[{text:"启用",value:0},{text:"禁用",value:1}],form:{mapMethod:[]},visible:0,searchParams:{},data:[{title:"环境",key:"configProfile",multiple:!1,options:[{label:"全部",value:""}]}],row:{},profiles:[],applications:[],list:{apiObj:this.$API.config.config.page,apiObjUpdate:this.$API.config.config.update,apiObjSave:this.$API.config.config.save,apiObjDelete:this.$API.config.config.delete},selection:[]}},mounted(){this.initial()},methods:{selectionChange(n){this.selection=n},search(){this.$refs.table.reload(this.searchParams)},table_del(n){this.list.apiObjDelete.delete(n).then(l=>{if(l.code==="00000")return this.$message.success("操作成功"),this.search(),0;this.$message.error(l.msg)})},async batch_del(){this.$confirm(`确定删除选中的 ${this.selection.length} 项吗？如果删除项中含有子集将会被一并删除`,"提示",{type:"warning"}).then(()=>{const n=this.$loading(),l=[];for(const d of this.selection)l.push(d.configId);this.list.apiObjDelete.delete({configId:l.join(",")}).then(d=>{if(d.code==="00000")return this.$message.success("操作成功"),this.search(),0}).finally(()=>{n.close()})}).catch(()=>{})},table_edit(n){this.visible=!0,this.row=n,delete this.row.disable},async initial(){const n=await this.$API.config.config.profile.get();n.code==="00000"&&(this.profiles=n.data,n.data.forEach(d=>{this.data[0].options.push({label:d,value:d})}));const l=await this.$API.config.config.applications.get();l.code==="00000"&&(this.applications=l.data)},submitFormUpdate(n){this.list.apiObjSave.post(n||this.row).then(l=>{if(l.code==="00000")return this.$message.success("操作成功"),this.search(),this.visible=!1,0;this.$message.error(l.msg)})},filterHandler(n,l,d){const k=d.property;return l[k]===n},change(n){this.searchParams=n,this.$refs.table.reload(n)}}},q={class:"left-panel"},G=C("br",null,null,-1),J={class:"right-panel"};function K(n,l,d,k,i,r){const O=a("sc-select-filter"),u=a("el-button"),x=a("el-header"),f=a("el-table-column"),N=a("el-tag"),A=a("el-switch"),D=a("el-popconfirm"),F=a("el-button-group"),S=a("scTable"),B=a("el-main"),T=a("el-container"),h=a("el-input"),p=a("el-form-item"),P=a("el-option"),I=a("el-select"),z=a("el-form"),E=a("el-dialog"),w=L("auth");return s(),v(y,null,[o(T,null,{default:t(()=>[o(x,null,{default:t(()=>[C("div",q,[o(O,{data:i.data,"selected-values":n.selectedValues,"label-width":80,onOnChange:r.change},null,8,["data","selected-values","onOnChange"]),G]),C("div",J,[o(u,{type:"primary",icon:"el-icon-search",onClick:r.search},null,8,["onClick"]),o(u,{type:"primary",icon:"el-icon-plus",onClick:l[0]||(l[0]=e=>r.table_edit({}))}),o(u,{type:"danger",plain:"",icon:"el-icon-delete",disabled:i.selection.length==0,onClick:r.batch_del},null,8,["disabled","onClick"])])]),_:1}),o(B,{class:"nopadding"},{default:t(()=>[o(S,{ref:"table",apiObj:i.list.apiObj,"row-key":"id",stripe:"",onSelectionChange:r.selectionChange},{default:t(()=>[o(f,{type:"selection",width:"50"}),o(f,{label:"应用名称",prop:"configApplicationName",width:"150"}),o(f,{label:"环境",prop:"configProfile",width:"150"},{default:t(e=>[o(N,null,{default:t(()=>[m(U(e.row.configProfile),1)]),_:2},1024)]),_:1}),o(f,{label:"配置名称",prop:"configName"}),o(f,{label:"配置值",prop:"configValue","show-overflow-tooltip":""}),o(f,{label:"描述",prop:"configDesc","show-overflow-tooltip":""}),o(f,{label:"是否禁用",prop:"disable",width:"150",filters:i.statusFilters,"filter-method":r.filterHandler},{default:t(e=>{var g;return[(g=e.row.configName)!=null&&g.startsWith("config-")?(s(),c(N,{key:1},{default:t(()=>[m(U(e.row.disable==1?"是":"否"),1)]),_:2},1024)):(s(),c(A,{key:0,onChange:b=>r.submitFormUpdate(e.row),modelValue:e.row.disable,"onUpdate:modelValue":b=>e.row.disable=b,class:"ml-2","active-value":0,"inactive-value":1,style:{"--el-switch-on-color":"#ff4949","--el-switch-off-color":"#13ce66"}},null,8,["onChange","modelValue","onUpdate:modelValue"]))]}),_:1},8,["filters","filter-method"]),o(f,{label:"操作",fixed:"right",align:"right",width:"260"},{default:t(e=>{var g;return[(g=e.row.configName)!=null&&g.startsWith("config-")?V("v-if",!0):(s(),c(F,{key:0},{default:t(()=>[_((s(),c(u,{text:"",type:"primary",size:"small",onClick:b=>r.table_edit(e.row,e.$index)},{default:t(()=>[m("编辑")]),_:2},1032,["onClick"])),[[w,"sys:config:edit"]]),_((s(),c(D,{title:"确定删除吗？",onConfirm:b=>r.table_del(e.row,e.$index)},{reference:t(()=>[_((s(),c(u,{text:"",type:"primary",size:"small"},{default:t(()=>[m("删除")]),_:1})),[[w,"sys:config:del"]])]),_:2},1032,["onConfirm"])),[[w,"sys:config:del"]])]),_:2},1024))]}),_:1})]),_:1},8,["apiObj","onSelectionChange"])]),_:1})]),_:1}),o(E,{draggable:"",modelValue:i.visible,"onUpdate:modelValue":l[9]||(l[9]=e=>i.visible=e),width:500,"destroy-on-close":"",onClosed:l[10]||(l[10]=e=>n.$emit("closed"))},{footer:t(()=>[o(u,{onClick:l[7]||(l[7]=e=>i.visible=!1)},{default:t(()=>[m("取 消")]),_:1}),n.mode!="show"?(s(),c(u,{key:0,type:"primary",loading:n.isSaveing,onClick:l[8]||(l[8]=e=>r.submitFormUpdate())},{default:t(()=>[m("保 存")]),_:1},8,["loading"])):V("v-if",!0)]),default:t(()=>[o(z,{model:i.form,disabled:n.mode=="show",ref:"dialogForm","label-width":"100px","label-position":"left"},{default:t(()=>[_(o(p,{label:"索引",prop:"configName"},{default:t(()=>[o(h,{modelValue:i.row.configId,"onUpdate:modelValue":l[1]||(l[1]=e=>i.row.configId=e),clearable:""},null,8,["modelValue"])]),_:1},512),[[M,!1]]),o(p,{label:"环境",prop:"configProfile"},{default:t(()=>[o(I,{"allow-create":"",filterable:"",modelValue:i.row.configProfile,"onUpdate:modelValue":l[2]||(l[2]=e=>i.row.configProfile=e)},{default:t(()=>[(s(!0),v(y,null,j(i.profiles,e=>(s(),c(P,{label:e,value:e},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),i.row.configId?V("v-if",!0):(s(),c(p,{key:0,label:"应用名称",prop:"configApplicationName"},{default:t(()=>[o(I,{"allow-create":"",filterable:"",modelValue:i.row.configApplicationName,"onUpdate:modelValue":l[3]||(l[3]=e=>i.row.configApplicationName=e)},{default:t(()=>[(s(!0),v(y,null,j(i.applications,e=>(s(),c(P,{label:e,value:e},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})),o(p,{label:"配置名称",prop:"configName"},{default:t(()=>[o(h,{readonly:i.row.configId,disabled:i.row.configId,modelValue:i.row.configName,"onUpdate:modelValue":l[4]||(l[4]=e=>i.row.configName=e),clearable:""},null,8,["readonly","disabled","modelValue"])]),_:1}),o(p,{label:"配置值",prop:"configValue"},{default:t(()=>[o(h,{modelValue:i.row.configValue,"onUpdate:modelValue":l[5]||(l[5]=e=>i.row.configValue=e),clearable:""},null,8,["modelValue"])]),_:1}),o(p,{label:"描述",prop:"configDesc"},{default:t(()=>[o(h,{modelValue:i.row.configDesc,"onUpdate:modelValue":l[6]||(l[6]=e=>i.row.configDesc=e),clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","disabled"])]),_:1},8,["modelValue"])],64)}const X=W(Z,[["render",K],["__file","Z:/workspace/vue-support-parent-starter/vue-support-config-starter/src/views/config/config/index.vue"]]);export{X as default};
