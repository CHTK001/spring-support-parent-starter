import{s as S}from"./index-4d05358e.js";import{_ as x,r as o,o as r,g as p,w as u,b as l,d as a,c as h,f as F,F as I,h as C,l as f}from"./index-56cdd313.js";import{A as m}from"./ansi_up-bc878127.js";const A=new m,L={name:"UniformLog",components:{scSelectFilter:S},data(){return{input:"",showFile:0,data:[],selectedValues:{},selectedValuesItem:[{title:"模块",key:"module",multiple:!1,options:[]}],eventSource:null}},updated(){this.$refs.containerRef.scrollTop=this.$refs.containerRef.scrollHeight},mounted(){this.initial(),this.change({module:""})},created(){var e=this;document.onkeydown=function(t){window.event.keyCode==113&&(e.showFile=!0,e.input="",e.nextTick(()=>{e.$refs.input.focus()}))}},methods:{change(e){this.selectedValues=e,this.subscribe((this.selectedValues.module||"log")=="log"?"log":"log"+this.selectedValues.module)},async initial(){const e=await this.$API.config.actuator.applications.get();if(e.code==="00000"&&this.selectedValuesItem[0].options.length==0){this.selectedValuesItem[0].options.push({label:"全部",value:""});for(const t of e.data)this.selectedValuesItem[0].options.push({label:t,value:t})}},enterQuery(){this.$API.config.search.get({keyword:this.input}).then(e=>{e.code==="00000"&&(this.data.length=0,this.data=e.data.map(t=>A.ansi_to_html(t==null?void 0:t.message)),this.showFile=0)})},subscribe:function(e){const t=this;var c=new m;if(this.eventSource)try{this.eventSource.close()}catch{}this.eventSource=new EventSource(this.$API.config.uniform.url+e),this.eventSource.addEventListener(e,i=>{const n=JSON.parse(i.data);this.data.push(c.ansi_to_html(n.message).replaceAll(`
`,"<br/>")),this.data.length>1e4&&this.data.shift()}),this.eventSource.onerror=function(i){},this.eventSource.onopen=function(i){t.$notify.success({title:"提示",dangerouslyUseHTMLString:!0,message:"订阅成功"})}}}},E={class:"left-panel"},T=a("br",null,null,-1),U=["innerHTML"];function B(e,t,c,i,n,d){const _=o("sc-select-filter"),g=o("el-header"),v=o("el-empty"),y=o("el-button"),w=o("el-input"),V=o("el-dialog"),k=o("el-main"),b=o("el-container");return r(),p(b,null,{default:u(()=>[l(g,null,{default:u(()=>[a("div",E,[l(_,{data:n.selectedValuesItem,"selected-values":n.selectedValues,"label-width":80,onOnChange:d.change},null,8,["data","selected-values","onOnChange"]),T])]),_:1}),l(k,null,{default:u(()=>[a("div",{ref:"containerRef",style:{height:"100%",overflow:"auto"},onKeyup:t[0]||(t[0]=f((...s)=>e.keyEvent&&e.keyEvent(...s),["native"]))},[a("ul",null,[(r(!0),h(I,null,F(n.data,s=>(r(),h("li",null,[a("span",{innerHTML:s},null,8,U)]))),256))]),!n.data||n.data.length==0?(r(),p(v,{key:0})):C("v-if",!0)],544),l(y,{type:"primary",icon:"el-icon-search",style:{position:"fixed",right:"0",top:"50%",width:"40px",height:"40px"},onClick:t[1]||(t[1]=s=>n.showFile=!0)}),l(V,{draggable:"",modelValue:n.showFile,"onUpdate:modelValue":t[3]||(t[3]=s=>n.showFile=s)},{default:u(()=>[l(w,{ref:"input",modelValue:n.input,"onUpdate:modelValue":t[2]||(t[2]=s=>n.input=s),placeholder:"搜索",size:"large",clearable:"","prefix-icon":"el-icon-search",onKeyup:f(d.enterQuery,["enter"]),"trigger-on-focus":!1},null,8,["modelValue","onKeyup"])]),_:1},8,["modelValue"])]),_:1})]),_:1})}const M=x(L,[["render",B],["__file","Z:/workspace/vue-support-parent-starter/vue-support-config-starter/src/views/config/log/index.vue"]]);export{M as default};
