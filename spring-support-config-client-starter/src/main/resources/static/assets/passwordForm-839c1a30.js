import{_ as O,E as A,D as u,r as g,o as b,g as S,w as f,b as c,d as v,e as C,t as _,l as k}from"./index-56cdd313.js";import{a as T}from"./index-189890cf.js";import"./about-68ef1110.js";import"./echarts-f4f7c9a9.js";import"./index-dec39fb0.js";import"./progress-78bea78c.js";import"./space-b3394fcf.js";import"./time-3b302bef.js";import"./ver-e6f7febf.js";import"./welcome-b0c54c0c.js";import"./Utils-6de69ef8.js";const p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";class ${encode(e){if(!e)return"";var o="",t,r,a,s,n,h,d,i=0;for(e=this._utf8_encode(e);i<e.length;)t=e.charCodeAt(i++),r=e.charCodeAt(i++),a=e.charCodeAt(i++),s=t>>2,n=(t&3)<<4|r>>4,h=(r&15)<<2|a>>6,d=a&63,isNaN(r)?h=d=64:isNaN(a)&&(d=64),o=o+p.charAt(s)+p.charAt(n)+p.charAt(h)+p.charAt(d);return o}decode(e){if(!e)return"";var o="",t,r,a,s,n,h,d,i=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<e.length;)s=p.indexOf(e.charAt(i++)),n=p.indexOf(e.charAt(i++)),h=p.indexOf(e.charAt(i++)),d=p.indexOf(e.charAt(i++)),t=s<<2|n>>4,r=(n&15)<<4|h>>2,a=(h&3)<<6|d,o=o+String.fromCharCode(t),h!=64&&(o=o+String.fromCharCode(r)),d!=64&&(o=o+String.fromCharCode(a));return o=this._utf8_decode(o),o}_utf8_encode(e){e=e.replace(/\r\n/g,`
`);for(var o="",t=0;t<e.length;t++){var r=e.charCodeAt(t);r<128?o+=String.fromCharCode(r):r>127&&r<2048?(o+=String.fromCharCode(r>>6|192),o+=String.fromCharCode(r&63|128)):(o+=String.fromCharCode(r>>12|224),o+=String.fromCharCode(r>>6&63|128),o+=String.fromCharCode(r&63|128))}return o}_utf8_decode(e){var o="",t=0;let r=0,a=0,s=0;for(;t<e.length;)r=e.charCodeAt(t),r<128?(o+=String.fromCharCode(r),t++):r>191&&r<224?(s=e.charCodeAt(t+1),o+=String.fromCharCode((r&31)<<6|s&63),t+=2):(s=e.charCodeAt(t+1),a=e.charCodeAt(t+2),o+=String.fromCharCode((r&15)<<12|(s&63)<<6|a&63),t+=3);return o}}const I=new $;const V={data(){return{userType:"admin",form:{user:"",password:"",autologin:!1,verifyCode:void 0},rules:{user:[{required:!0,message:this.$t("login.userError"),trigger:"blur"}],password:[{required:!0,message:this.$t("login.PWError"),trigger:"blur"}]},captchaBase64Key:void 0,captchaBase64:void 0,islogin:!1}},watch:{userType(l){l=="admin"?(this.form.user="",this.form.password=""):l=="user"&&(this.form.user="",this.form.password="")}},mounted(){this.getCaptcha()},methods:{getCaptcha(){this.$API.auth.captcha.get().then(({data:l})=>{const{verifyCodeBase64:e,verifyCodeKey:o}=l;this.captchaBase64=e,this.captchaBase64Key=o})},async login(){var r,a,s,n,h,d;if(I.decode(this.captchaBase64Key)!=this.form.verifyCode)return A({type:"error",message:"校验码不正确"}),this.getCaptcha(),!1;var l=await this.$refs.loginForm.validate().catch(()=>{});if(!l)return!1;this.islogin=!0;var e={username:this.form.user,password:this.$TOOL.crypto.MD5(this.form.password),verifyCode:this.form.verifyCode};try{var o=await this.$API.auth.token.post(e)}catch(i){this.getCaptcha(),console.log(i),this.islogin=!1;return}if(this.getCaptcha(),o.code==="00000")this.$TOOL.cookie.set(u.TOKEN,o.data.accessToken,{expires:this.form.autologin?24*60*60:0}),this.$TOOL.data.set(u.USER_INFO,o.data.userInfo);else return this.islogin=!1,this.$message.warning(o.msg),!1;var t=null;try{t=await this.$API.auth.menus.get()}catch(i){this.getCaptcha(),console.log(i),this.islogin=!1;return}if(t.code=="00000"){if(t.data.menu.length==0)return this.islogin=!1,this.$alert("当前用户无任何菜单权限，请联系系统管理员","无权限访问",{type:"error",center:!0}),!1;this.$TOOL.data.set(u.MENU,t.data.menu),this.$TOOL.data.set(u.PERMISSIONS,(r=t.data)==null?void 0:r.permissions),(!t.data.dashboardGrid||!t.data.dashboardGrid.length)&&o.data.userInfo.roles.indexOf(u.ADMIN)>-1&&(t.data.dashboardGrid=Object.keys(T)),this.$TOOL.data.set(u.DASHBOARD_GRID,(a=t.data)==null?void 0:a.dashboardGrid),this.$TOOL.data.set(u.DASHBOARD_TYPE,(s=t.data)==null?void 0:s.dashboard),(h=(n=t.data)==null?void 0:n.grid)!=null&&h.copmsList?this.$TOOL.data.set(u.GRID,(d=t.data)==null?void 0:d.grid):this.$TOOL.data.remove(u.GRID)}else return this.islogin=!1,this.$message.warning(t.msg),!1;this.$router.replace({path:"/"}),this.$message.success("Login Success 登录成功"),this.islogin=!1}}},B={span:6,class:"captcha"},N=["src"],D={class:"login-reg"};function L(l,e,o,t,r,a){const s=g("el-input"),n=g("el-form-item"),h=g("el-checkbox"),d=g("el-col"),i=g("router-link"),y=g("el-button"),w=g("el-form");return b(),S(w,{ref:"loginForm",model:r.form,rules:r.rules,"label-width":"0",size:"large",onKeyup:k(a.login,["enter"])},{default:f(()=>[c(n,{prop:"user"},{default:f(()=>[c(s,{modelValue:r.form.user,"onUpdate:modelValue":e[0]||(e[0]=m=>r.form.user=m),"prefix-icon":"el-icon-user",clearable:"",placeholder:l.$t("login.userPlaceholder")},null,8,["modelValue","placeholder"])]),_:1}),c(n,{prop:"password"},{default:f(()=>[c(s,{modelValue:r.form.password,"onUpdate:modelValue":e[1]||(e[1]=m=>r.form.password=m),"prefix-icon":"el-icon-lock",clearable:"","show-password":"",placeholder:l.$t("login.PWPlaceholder")},null,8,["modelValue","placeholder"])]),_:1}),c(n,{prop:"verifyCode"},{default:f(()=>[c(s,{span:6,modelValue:r.form.verifyCode,"onUpdate:modelValue":e[2]||(e[2]=m=>r.form.verifyCode=m),class:"verifyCode",clearable:"",placeholder:l.$t("login.verifyCode")},null,8,["modelValue","placeholder"]),v("div",B,[v("img",{src:r.captchaBase64,onClick:e[3]||(e[3]=(...m)=>a.getCaptcha&&a.getCaptcha(...m))},null,8,N)])]),_:1}),c(n,{style:{"margin-bottom":"10px"}},{default:f(()=>[c(d,{span:12},{default:f(()=>[c(h,{label:l.$t("login.rememberMe"),modelValue:r.form.autologin,"onUpdate:modelValue":e[4]||(e[4]=m=>r.form.autologin=m)},null,8,["label","modelValue"])]),_:1}),c(d,{span:12,class:"login-forgot"},{default:f(()=>[c(i,{to:"/reset_password"},{default:f(()=>[C(_(l.$t("login.forgetPassword"))+"？",1)]),_:1})]),_:1})]),_:1}),c(n,null,{default:f(()=>[c(y,{type:"primary",style:{width:"100%"},loading:r.islogin,round:"",onClick:a.login},{default:f(()=>[C(_(l.$t("login.signIn")),1)]),_:1},8,["loading","onClick"])]),_:1}),v("div",D,[C(_(l.$t("login.noAccount"))+" ",1),c(i,{to:"/user_register"},{default:f(()=>[C(_(l.$t("login.createAccount")),1)]),_:1})])]),_:1},8,["model","rules","onKeyup"])}const H=O(V,[["render",L],["__scopeId","data-v-b1b4f708"],["__file","Z:/workspace/vue-support-parent-starter/vue-support-config-starter/src/views/login/components/passwordForm.vue"]]);export{H as default};
