import{s as R}from"./index-8baa2384.js";import F from"./info-f89c4ac3.js";import{_ as P,r as n,y as W,o as d,c as y,a as e,w as l,b as v,g as c,F as k,i as I,e as m,t as j,z as T,h as b,B as Y}from"./index-452c6e27.js";const J={name:"log",components:{info:F,scEcharts:R},data(){return{clearType:1,loading:!1,date:[],defaultValueDate:{},form:{jobGroup:0,jobId:0,logStatus:0},jobName:"全部",jobGroupName:"全部",data:{},executorData:[],jobData:[],jobGroup:this.$API.scheduler.jobGroup,jobInfo:this.$API.scheduler.getJobsByGroup,apiObj:this.$API.scheduler.joblog,clearShow:!1,infoDrawer:!1,logsChartOption2:{color:["#00A65A","#c23632","#F39C12"],tooltip:{trigger:"item"},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{show:!1,type:"value"},series:[{radius:"55%",center:["50%","50%"],data:[],type:"pie",stack:"log",barWidth:"15px",roseType:"radius",label:{color:"rgba(255, 255, 255, 0.3)"},labelLine:{lineStyle:{color:"rgba(255, 255, 255, 0.3)"},smooth:.2,length:10,length2:20},itemStyle:{color:"#c23531",shadowBlur:20,shadowColor:"rgba(0, 0, 0, 0.5)"},animationType:"scale",animationEasing:"elasticOut",animationDelay:function(s){return Math.random()*200}}]},logsChartOption:{color:["#409eff","#e6a23c","#f56c6c"],grid:{top:"0px",left:"10px",right:"10px",bottom:"0px"},tooltip:{trigger:"axis"},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{show:!1,type:"value"},series:[{data:[],type:"line",name:"失败",stack:"Total",label:{normal:{show:!0,position:"top"}},areaStyle:{normal:{}},barWidth:"15px"},{data:[],type:"line",name:"进行中",stack:"Total",areaStyle:{normal:{}},barWidth:"15px"},{data:[],name:"成功",type:"line",stack:"Total",areaStyle:{normal:{}},barWidth:"15px"}]},category:[]}},watch:{},mounted:function(){this.form.jobGroup=~~this.$route.params.jobGroup,this.form.jobId=~~this.$route.params.jobId,this.initial()},methods:{rowClick(s){this.infoDrawer=!0,this.$nextTick(()=>{this.$refs.info.setData(s)})},doDetail(s){this.$router.push({path:"/scheduler/joblog/cat/"+s.id})},clear(){this.clearShow=!0},clearLog(s){this.$API.scheduler.clearLog.get({jobId:s,jobGroup:this.form.jobGroup,type:this.clearType}).then(o=>{if(o.code==="00000")return this.$message.success("清除成功"),this.clearShow=!1,!1;this.$message.error(o.msg)})},changeGroup(s){if(s){this.form.jobGroup=s;const o=this.executorData.filter(r=>r.id==s);return this.jobGroupName=o?o[0].title:"全部",!1}this.jobGroupName="全部"},changeJob(s){if(s){this.form.jobId=s;const o=this.jobData.filter(r=>r.id==s);return this.jobName=o?o[0].jobDesc:"全部",!1}this.jobName="全部"},async intiCharts(){const s={},o=this.$TOOL.date.getDateRang("pastWeek");s.startDate=o[0],s.endDate=o[1],this.$API.scheduler.joblogChart.get(s).then(r=>{var _,a,u,x,i,f,g;if(r.code==="00000"){this.logsChartOption.xAxis.data.length=0,this.logsChartOption.xAxis.data=(_=r.data)==null?void 0:_.content.triggerDayList,this.logsChartOption.series[0].data=(a=r.data)==null?void 0:a.content.triggerDayCountFailList,this.logsChartOption.series[1].data=(u=r.data)==null?void 0:u.content.triggerDayCountRunningList,this.logsChartOption.series[2].data=(x=r.data)==null?void 0:x.content.triggerDayCountSucList,this.logsChartOption2.xAxis.data.length=0;const p=this.logsChartOption.xAxis.data.length;this.logsChartOption2.series[0].data.push({value:(i=r.data)==null?void 0:i.content.triggerDayCountFailList[p-1],name:"失败"}),this.logsChartOption2.series[0].data.push({value:(f=r.data)==null?void 0:f.content.triggerDayCountRunningList[p-1],name:"进行中"}),this.logsChartOption2.series[0].data.push({value:(g=r.data)==null?void 0:g.content.triggerDayCountSucList[p-1],name:"成功"})}})},async initial(){this.intiCharts();const s=await this.jobGroup.get();if(this.executorData=s==null?void 0:s.data.data,!this.form.jobGroup)this.form.jobGroup=this.executorData&&this.executorData.length==1?this.executorData[0].id:0,this.jobGroupName=this.executorData&&this.executorData.length==1?this.executorData[0].title:"";else{const o=this.executorData&&this.executorData.length>0?this.executorData.filter(r=>r.id==this.form.jobGroup):[];o.length>0&&(this.jobGroupName=o[0].title)}if(this.form.jobGroup){const o=await this.jobInfo.get({jobGroup:this.form.jobGroup});if(this.jobData=o==null?void 0:o.data.content,!this.form.jobId)this.form.jobId=this.jobData&&this.jobData.length==1?this.jobData[0].id:0,this.jobName=this.jobData&&this.jobData.length==1?this.jobData[0].jobDesc:void 0;else{const r=this.jobData&&this.jobData.length>0?this.jobData.filter(_=>_.id==this.form.jobId):[];r.length>0&&(this.jobName=r[0].title)}}this.search()},search(){this.date&&(this.form.filterTime=this.date.join(" - ")),this.form.jobId||(this.form.jobId=0),this.$refs.table.reload(this.form)},rowClick(s){this.infoDrawer=!0,this.$nextTick(()=>{this.$refs.info.setData(s)})}}},H={class:"left-panel"},Z={class:"right-panel"},q={class:"right-panel-search"},K={style:{float:"left"}},Q={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},X={style:{float:"left"}},$={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},ee={key:0},te={key:1},oe={class:"dialog-footer"};function le(s,o,r,_,a,u){const x=n("el-date-picker"),i=n("el-option"),f=n("el-select"),g=n("el-input"),p=n("el-button"),V=n("el-header"),N=n("scEcharts"),S=n("sc-status-indicator"),A=n("el-icon-info-filled"),L=n("el-icon"),h=n("el-table-column"),w=n("el-tag"),M=n("scTable"),G=n("el-main"),D=n("el-container"),C=n("el-form-item"),U=n("el-form"),B=n("el-dialog"),E=n("info"),z=n("el-drawer"),O=W("time");return d(),y(k,null,[e(D,null,{default:l(()=>[v(` <el-aside width="220px">\r
			<el-tree ref="category" class="menu" node-key="label" :data="category" :default-expanded-keys="['系统日志']"\r
				current-node-key="系统日志" :highlight-current="true" :expand-on-click-node="false">\r
			</el-tree>\r
		</el-aside> `),e(D,null,{default:l(()=>[e(G,{class:"nopadding"},{default:l(()=>[e(D,null,{default:l(()=>[e(V,null,{default:l(()=>[c("div",H,[e(x,{modelValue:a.date,"onUpdate:modelValue":o[0]||(o[0]=t=>a.date=t),"value-format":"YYYY-MM-DD HH:MM:ss",type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),c("div",Z,[c("div",q,[e(f,{modelValue:a.form.logStatus,"onUpdate:modelValue":o[1]||(o[1]=t=>a.form.logStatus=t),filterable:"",style:{width:"100%"}},{default:l(()=>[e(i,{value:0,label:"全部"}),e(i,{value:1,label:"成功"}),e(i,{value:2,label:"失败"}),e(i,{value:3,label:"进行中"})]),_:1},8,["modelValue"]),e(f,{modelValue:a.form.jobGroup,"onUpdate:modelValue":o[2]||(o[2]=t=>a.form.jobGroup=t),filterable:"",style:{width:"100%"},onChange:u.changeGroup},{default:l(()=>[e(i,{value:0,label:"全部"}),(d(!0),y(k,null,I(a.executorData,t=>(d(),m(i,{value:t.id,label:t.appname},{default:l(()=>[c("span",K,j(t.appname),1),c("span",Q,j(t.title),1)]),_:2},1032,["value","label"]))),256))]),_:1},8,["modelValue","onChange"]),e(f,{modelValue:a.form.jobId,"onUpdate:modelValue":o[3]||(o[3]=t=>a.form.jobId=t),filterable:"",style:{width:"100%"},onChange:u.changeJob},{default:l(()=>[e(i,{value:0,label:"全部"}),(d(!0),y(k,null,I(a.jobData,t=>(d(),m(i,{value:t.id,label:t.jobDesc},{default:l(()=>[c("span",X,j(t.jobDesc),1),c("span",$,j(t.jobDesc),1)]),_:2},1032,["value","label"]))),256))]),_:1},8,["modelValue","onChange"]),e(g,{modelValue:u.search.keyword,"onUpdate:modelValue":o[4]||(o[4]=t=>u.search.keyword=t),placeholder:"关键词",clearable:""},null,8,["modelValue"]),e(p,{type:"primary",icon:"el-icon-search",onClick:u.search},null,8,["onClick"]),e(p,{type:"danger",icon:"el-icon-delete",onClick:u.clear},null,8,["onClick"])])])]),_:1}),e(V,{style:{height:"150px"}},{default:l(()=>[e(N,{height:"100%",option:a.logsChartOption},null,8,["option"]),v(' <scEcharts height="100%" :option="logsChartOption2"></scEcharts> ')]),_:1}),e(G,{class:"nopadding"},{default:l(()=>[e(M,{ref:"table",loading:a.loading,params:a.form,apiObj:a.apiObj,stripe:"",highlightCurrentRow:"",onRowClick:u.rowClick},{default:l(()=>[e(h,{label:"级别",prop:"level",width:"60"},{default:l(t=>[t.row.triggerCode==500?(d(),m(S,{key:0,pulse:"",type:"warning",title:"結果失败"})):(d(),m(L,{key:1,style:{color:"#068f3f"}},{default:l(()=>[e(A)]),_:1}))]),_:1}),e(h,{label:"任务ID",prop:"id",width:"150"}),e(h,{label:"调度时间",prop:"triggerTime",width:"150"},{default:l(t=>[T(c("span",null,null,512),[[O,t.row.triggerTime]])]),_:1}),e(h,{label:"调度结果",prop:"logMapping","show-overflow-tooltip":""},{default:l(t=>[t.row.triggerCode==500?(d(),m(w,{key:0,type:"danger"},{default:l(()=>[b("失败")]),_:1})):(d(),m(w,{key:1,type:"success"},{default:l(()=>[b("成功")]),_:1}))]),_:1}),e(h,{label:"调度备注",prop:"logAddress",width:"150"},{default:l(t=>[e(p,{text:"",type:"primary",size:"small"},{default:l(()=>[b("查看")]),_:1})]),_:1}),e(h,{label:"执行时间",prop:"handleTime"},{default:l(t=>[T(c("span",null,null,512),[[O,t.row.handleTime]])]),_:1}),e(h,{label:"执行结果",prop:"handleCode"},{default:l(t=>[t.row.handleCode!==200?(d(),m(w,{key:0,type:"danger"},{default:l(()=>[b("失败")]),_:1})):(d(),m(w,{key:1,type:"success"},{default:l(()=>[b("成功")]),_:1}))]),_:1}),e(h,{label:"执行备注",prop:"handleMsg",width:"150"},{default:l(t=>[t.row.handleMsg?(d(),y("span",ee,j(t.row.handleMsg),1)):(d(),y("span",te,"无"))]),_:1}),e(h,{label:"操作",prop:"operator",fixed:!1},{default:l(t=>[e(p,{text:"",plain:"",icon:"el-icon-view",title:"详情",style:{"z-index":"999999"},onClick:Y(ae=>u.doDetail(t.row),["stop"])},null,8,["onClick"])]),_:1}),v(` <el-table-column label="操作" prop="logCost">\r
                                <template #default="scope">\r
                                    <el-badge v-if="scope.row.logCost > 1000">{{ scope.row.logCost }} ms</el-badge>\r
                                    <span v-else>{{ scope.row.logCost }} ms</span>\r
                                </template>\r
                            </el-table-column> `)]),_:1},8,["loading","params","apiObj","onRowClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(B,{title:"日志清理",modelValue:a.clearShow,"onUpdate:modelValue":o[10]||(o[10]=t=>a.clearShow=t),onClose:o[11]||(o[11]=t=>a.clearShow=!1)},{footer:l(()=>[c("span",oe,[e(p,{onClick:o[8]||(o[8]=t=>a.clearShow=!1)},{default:l(()=>[b("取消")]),_:1}),e(p,{type:"primary",onClick:o[9]||(o[9]=t=>u.clearLog(0))},{default:l(()=>[b("确定")]),_:1})])]),default:l(()=>[e(U,{model:a.form,"label-width":"120px"},{default:l(()=>[e(C,{label:"执行器"},{default:l(()=>[e(g,{disabled:"",readonly:"",modelValue:a.jobGroupName,"onUpdate:modelValue":o[5]||(o[5]=t=>a.jobGroupName=t)},null,8,["modelValue"])]),_:1}),e(C,{label:"任务"},{default:l(()=>[e(g,{disabled:"",readonly:"",modelValue:a.jobName,"onUpdate:modelValue":o[6]||(o[6]=t=>a.jobName=t)},null,8,["modelValue"])]),_:1}),e(C,{label:""},{default:l(()=>[e(f,{modelValue:a.clearType,"onUpdate:modelValue":o[7]||(o[7]=t=>a.clearType=t),style:{width:"100%"}},{default:l(()=>[e(i,{label:"清理一个月之前的日志数据",value:1}),e(i,{label:"清理三个月之前的日志数据",value:2}),e(i,{label:"清理六个月之前的日志数据",value:3}),e(i,{label:"清理一年之前的日志数据",value:4}),e(i,{label:"清理一千条之前的日志数据",value:5}),e(i,{label:"清理一万条之前的日志数据",value:6}),e(i,{label:"清理三万条之前的日志数据",value:7}),e(i,{label:"清理十万条之前的日志数据",value:8}),e(i,{label:"清理所以日志数据",value:9})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(z,{modelValue:a.infoDrawer,"onUpdate:modelValue":o[12]||(o[12]=t=>a.infoDrawer=t),title:"日志详情",size:800,"destroy-on-close":""},{default:l(()=>[e(E,{ref:"info"},null,512)]),_:1},8,["modelValue"])],64)}const re=P(J,[["render",le],["__file","Z:/workspace/vue-support-parent-starter/vue-support-scheduler-starter/src/views/scheduler/joblog/index.vue"]]);export{re as default};
