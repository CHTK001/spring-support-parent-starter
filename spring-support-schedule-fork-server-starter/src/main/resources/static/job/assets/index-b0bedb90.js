import J from"./save-555913b7.js";import{_ as K,r as i,o as u,c as m,a as e,w as o,g as a,F as y,i as w,e as p,t as g,h as d,b,p as M,k as Q}from"./index-bd432aa0.js";const W={name:"Task",components:{save:J},data(){return{triggerId:void 0,executorParam:"",addressList:"",triggerTitle:"",triggerShow:!1,saveShow:!1,jobinfoNextTriggerTimeShow:!1,jobgroupByIdShow:!1,triggerLoadding:!1,apiObj:this.$API.scheduler.pageList,jobGroup:this.$API.scheduler.jobGroup,form:{triggerStatus:-1,jobDesc:void 0,jobGroup:0,size:10},data:[],loading:!1,executorData:[],jobinfoNextTriggerTimeData:[],jobgroupByIdData:{},total:0,filterData:[{title:"所属行业",key:"triggerStatus",multiple:!0,options:[{label:"全部",value:-1},{label:"停止",value:0},{label:"启动",value:1}]}]}},mounted(){this.initial()},methods:{handlerSuccess(){this.search()},edit(s){this.saveShow=!0,this.$nextTick(()=>{this.$refs.saveRef.open("edit",s)})},copy(s){this.saveShow=!0,this.$nextTick(()=>{this.$refs.saveRef.open("copy",s)})},del(s){this.$API.scheduler.jobinfoRemove.get({id:s.id}).then(l=>{if(l.code==="00000")return this.data=this.data.filter(c=>c.id!=s.id),this.$message.success("操作成功"),!1;this.$message.error(l.msg)})},start(s){this.$API.scheduler.jobinfoStart.get({id:s.id}).then(l=>{if(l.code==="00000"){const c=this.data.filter(k=>k.id==s.id);return c&&c.length>0&&(c[0].triggerStatus=1),this.$message.success("操作成功"),!1}this.$message.error(l.msg)})},stop(s){this.$API.scheduler.jobinfoStop.get({id:s.id}).then(l=>{if(l.code==="00000"){const c=this.data.filter(k=>k.id==s.id);return c&&c.length>0&&(c[0].triggerStatus=0),this.$message.success("操作成功"),!1}this.$message.error(l.msg)})},add(){this.saveShow=!0,this.$nextTick(()=>{this.$refs.saveRef.open("add",{})})},triggerExecute(){this.$API.scheduler.jobinfoTrigger.get({id:this.triggerId,executorParam:this.executorParam,addressList:this.addressList}).then(s=>{if(s.code==="00000")return this.$message.success("操作成功"),this.triggerShow=!1,!1;this.$message.error(s.msg)}).finally(()=>this.triggerLoadding=!1)},trigger(s){this.triggerTitle=s.jobDesc+"(执行一次)",this.triggerShow=!0,this.triggerId=s.id},jobgroupById(s){this.$API.scheduler.jobgroupById.get({id:s.jobGroup}).then(l=>{if(l.code==="00000")return this.jobgroupByIdData=l.data.content,this.jobgroupByIdShow=!0,!1;this.$message.error(l.msg)})},logger(s){this.$router.push({path:"/scheduler/joblog/"+s.jobGroup+"/"+s.id})},nextTriggerTime(s){this.$API.scheduler.jobinfoNextTriggerTime.get({scheduleType:s.scheduleType,scheduleConf:s.scheduleConf}).then(l=>{if(l.code==="00000")return this.jobinfoNextTriggerTimeData=l.data.content,this.jobinfoNextTriggerTimeShow=!0,!1;this.$message.error(l.msg)})},async initial(){const s=await this.jobGroup.get();this.executorData=s==null?void 0:s.data.data,this.form.jobGroup=this.executorData&&this.executorData.length==1?this.executorData[0].id:0,this.search()},search(s){s&&Object.assign(this.form,s),this.$API.scheduler.pageList.get(this.form).then(l=>{this.data=l==null?void 0:l.data.data,this.total=l==null?void 0:l.data.recordsTotal})},filterChange(s){this.from.triggerStatus=s.triggerStatus}}},v=s=>(M("data-v-e871ab95"),s=s(),Q(),s),X=v(()=>a("div",{class:"left-panel"},null,-1)),Y={class:"right-panel"},Z={class:"right-panel-search"},$={style:{float:"left"}},ee={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},te=v(()=>a("h4",null,"运行模式",-1)),oe=v(()=>a("h4",null,"任务类型 ",-1)),le={class:"bottom"},se={class:"state"},ne=v(()=>a("span",{style:{"margin-left":"10px"}},null,-1)),ie={class:"handler"},ae=v(()=>a("p",null,"添加计划任务",-1)),re={class:"dialog-footer"},de={style:{padding:"5px"}},ue={style:{padding:"5px"}};function ce(s,l,c,k,n,r){const N=i("sc-select-filter"),T=i("el-header"),I=i("el-option"),A=i("el-select"),S=i("el-input"),f=i("el-button"),j=i("el-tag"),x=i("el-col"),V=i("el-row"),h=i("el-dropdown-item"),G=i("el-dropdown-menu"),z=i("el-dropdown"),D=i("el-card"),U=i("el-icon-plus"),R=i("el-icon"),P=i("el-main"),O=i("scPagintion"),E=i("el-footer"),B=i("el-container"),F=i("el-skeleton"),L=i("el-form-item"),H=i("el-form"),C=i("el-dialog"),q=i("save");return u(),m(y,null,[e(B,null,{default:o(()=>[e(T,{style:{height:"auto"}},{default:o(()=>[e(N,{data:n.filterData,"label-width":80,onOnChange:r.filterChange},null,8,["data","onOnChange"])]),_:1}),e(T,null,{default:o(()=>[X,a("div",Y,[a("div",Z,[e(A,{modelValue:n.form.jobGroup,"onUpdate:modelValue":l[0]||(l[0]=t=>n.form.jobGroup=t),filterable:"",style:{width:"100%"}},{default:o(()=>[e(I,{value:0,label:"全部"}),(u(!0),m(y,null,w(n.executorData,t=>(u(),p(I,{value:t.id,label:t.appname},{default:o(()=>[a("span",$,g(t.appname),1),a("span",ee,g(t.title),1)]),_:2},1032,["value","label"]))),256))]),_:1},8,["modelValue"]),e(S,{modelValue:n.form.jobDesc,"onUpdate:modelValue":l[1]||(l[1]=t=>n.form.jobDesc=t),placeholder:"任务描述",clearable:""},null,8,["modelValue"]),e(f,{type:"primary",icon:"el-icon-search",onClick:r.search},null,8,["onClick"])])])]),_:1}),e(P,{class:"nopadding"},{default:o(()=>[e(F,{loading:n.loading,animated:""},{default:o(()=>[e(B,null,{default:o(()=>[e(P,null,{default:o(()=>[e(V,{gutter:15},{default:o(()=>[(u(!0),m(y,null,w(n.data,t=>(u(),p(x,{xl:6,lg:6,md:8,sm:12,xs:24,key:t.id,class:"demo-progress"},{default:o(()=>[e(D,{class:"task task-item",shadow:"always"},{default:o(()=>[a("h2",null,[d(g(t.jobDesc)+" ",1),t.triggerStatus==0?(u(),p(j,{key:0,size:"small",type:"info"},{default:o(()=>[d("暂停")]),_:1})):b("v-if",!0),t.triggerStatus==1?(u(),p(j,{key:1,size:"small",type:"success"},{default:o(()=>[d("正在运行")]),_:1})):b("v-if",!0)]),e(V,null,{default:o(()=>[e(x,{span:24},{default:o(()=>[a("ul",null,[a("li",null,[te,a("p",null,g(t.glueType)+" "+g(t.executorHandler),1)]),a("li",null,[oe,a("p",null,[e(j,{effect:"light"},{default:o(()=>[d(g(t.scheduleType)+" "+g(t.scheduleConf),1)]),_:2},1024)])])])]),_:2},1024)]),_:2},1024),a("div",le,[a("div",se,[e(x,{span:24},{default:o(()=>[a("span",null,"创建人: "+g(t.author),1),ne,e(f,{size:"small",circle:"",onClick:_=>r.edit(t),icon:"el-icon-edit"},null,8,["onClick"])]),_:2},1024)]),a("div",ie,[e(z,{trigger:"click"},{dropdown:o(()=>[e(G,null,{default:o(()=>[e(h,{onClick:_=>r.trigger(t)},{default:o(()=>[d("执行一次")]),_:2},1032,["onClick"]),e(h,{onClick:_=>r.logger(t)},{default:o(()=>[d("查询日志")]),_:2},1032,["onClick"]),e(h,{onClick:_=>r.jobgroupById(t)},{default:o(()=>[d("注册节点")]),_:2},1032,["onClick"]),e(h,{onClick:_=>r.nextTriggerTime(t)},{default:o(()=>[d("下次执行时间")]),_:2},1032,["onClick"]),t.triggerStatus==0?(u(),p(h,{key:0,onClick:_=>r.start(t),divided:""},{default:o(()=>[d("启动")]),_:2},1032,["onClick"])):b("v-if",!0),t.triggerStatus==1?(u(),p(h,{key:1,onClick:_=>r.stop(t),divided:""},{default:o(()=>[d("停止")]),_:2},1032,["onClick"])):b("v-if",!0),e(h,{onClick:_=>r.edit(t)},{default:o(()=>[d("编辑")]),_:2},1032,["onClick"]),e(h,{onClick:_=>r.del(t)},{default:o(()=>[d("删除")]),_:2},1032,["onClick"]),e(h,{onClick:_=>r.copy(t)},{default:o(()=>[d("复制")]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[e(f,{type:"primary",icon:"el-icon-more",circle:"",plain:""})]),_:2},1024)])])]),_:2},1024)]),_:2},1024))),128)),e(x,{xl:6,lg:6,md:8,sm:12,xs:24},{default:o(()=>[e(D,{class:"task task-add",shadow:"never",onClick:r.add},{default:o(()=>[e(R,null,{default:o(()=>[e(U)]),_:1}),ae]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),e(E,{style:{height:"51px","line-height":"50px",padding:"0"}},{default:o(()=>[e(O,{pageSize:n.form.size,total:n.total,onDataChange:r.search},null,8,["pageSize","total","onDataChange"])]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}),e(C,{draggable:"",modelValue:n.triggerShow,"onUpdate:modelValue":l[5]||(l[5]=t=>n.triggerShow=t),title:n.triggerTitle},{footer:o(()=>[a("span",re,[e(f,{loading:n.triggerLoadding,onClick:l[4]||(l[4]=t=>n.triggerShow=!1)},{default:o(()=>[d("取消")]),_:1},8,["loading"]),e(f,{loading:n.triggerLoadding,type:"primary",onClick:r.triggerExecute},{default:o(()=>[d("确定")]),_:1},8,["loading","onClick"])])]),default:o(()=>[e(H,{model:n.form,"label-width":"120px"},{default:o(()=>[e(L,{label:"任务参数"},{default:o(()=>[e(S,{type:"textarea",rows:6,modelValue:n.executorParam,"onUpdate:modelValue":l[2]||(l[2]=t=>n.executorParam=t)},null,8,["modelValue"])]),_:1}),e(L,{label:"机器地址"},{default:o(()=>[e(S,{type:"textarea",rows:6,modelValue:n.addressList,"onUpdate:modelValue":l[3]||(l[3]=t=>n.addressList=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(C,{draggable:"",modelValue:n.jobinfoNextTriggerTimeShow,"onUpdate:modelValue":l[6]||(l[6]=t=>n.jobinfoNextTriggerTimeShow=t),title:"下一次执行时间",width:"20%"},{default:o(()=>[(u(!0),m(y,null,w(n.jobinfoNextTriggerTimeData,t=>(u(),m("p",de,g(t),1))),256))]),_:1},8,["modelValue"]),e(C,{draggable:"",modelValue:n.jobgroupByIdShow,"onUpdate:modelValue":l[7]||(l[7]=t=>n.jobgroupByIdShow=t),title:"注册地址",width:"20%"},{default:o(()=>[a("p",ue,g(n.jobgroupByIdData.appname),1)]),_:1},8,["modelValue"]),n.saveShow?(u(),p(q,{key:0,onSuccess:r.handlerSuccess,ref:"saveRef",onClose:l[8]||(l[8]=t=>n.saveShow=!1)},null,8,["onSuccess"])):b("v-if",!0)],64)}const _e=K(W,[["render",ce],["__scopeId","data-v-e871ab95"],["__file","F:/workspace/vue-support-parent-starter/vue-support-scheduler-starter/src/views/scheduler/jobinfo/index.vue"]]);export{_e as default};
