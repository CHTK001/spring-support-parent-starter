import{s as F}from"./index-13f63928.js";import P from"./info-57b54316.js";import W from"./cat-2b45e4cd.js";import{_ as J,r,y as Y,o as i,c as _,a as e,w as l,b as x,g as p,F as k,i as O,e as m,t as y,z as T,h as g,B as H}from"./index-22fa9e8a.js";const Z={name:"log",components:{info:P,scEcharts:F,cat:W},data(){return{clearType:1,catStatus:!1,loading:!1,date:[],defaultValueDate:{},form:{jobGroup:0,jobId:0,logStatus:0},jobName:"全部",jobGroupName:"全部",data:{},executorData:[],jobData:[],jobGroup:this.$API.scheduler.jobGroup,jobInfo:this.$API.scheduler.getJobsByGroup,apiObj:this.$API.scheduler.joblog,clearShow:!1,infoDrawer:!1,logsChartOption2:{color:["#00A65A","#c23632","#F39C12"],tooltip:{trigger:"item"},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{show:!1,type:"value"},series:[{radius:"55%",center:["50%","50%"],data:[],type:"pie",stack:"log",barWidth:"15px",roseType:"radius",label:{color:"rgba(255, 255, 255, 0.3)"},labelLine:{lineStyle:{color:"rgba(255, 255, 255, 0.3)"},smooth:.2,length:10,length2:20},itemStyle:{color:"#c23531",shadowBlur:20,shadowColor:"rgba(0, 0, 0, 0.5)"},animationType:"scale",animationEasing:"elasticOut",animationDelay:function(s){return Math.random()*200}}]},logsChartOption:{color:["#409eff","#e6a23c","#f56c6c"],grid:{top:"0px",left:"10px",right:"10px",bottom:"0px"},tooltip:{trigger:"axis"},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{show:!1,type:"value"},series:[{data:[],type:"line",name:"失败",stack:"Total",label:{normal:{show:!0,position:"top"}},areaStyle:{normal:{}},barWidth:"15px"},{data:[],type:"line",name:"进行中",stack:"Total",areaStyle:{normal:{}},barWidth:"15px"},{data:[],name:"成功",type:"line",stack:"Total",areaStyle:{normal:{}},barWidth:"15px"}]},category:[]}},watch:{},mounted:function(){this.form.jobGroup=~~this.$route.params.jobGroup,this.form.jobId=~~this.$route.params.jobId,this.initial()},methods:{rowClick(s){this.infoDrawer=!0,this.$nextTick(()=>{this.$refs.info.setData(s)})},doDetail(s){this.catStatus=!0,this.$nextTick(()=>{this.$refs.catRef.open().setData(s)})},clear(){this.clearShow=!0},clearLog(s){this.$API.scheduler.clearLog.get({jobId:s,jobGroup:this.form.jobGroup,type:this.clearType}).then(o=>{if(o.code==="00000")return this.$message.success("清除成功"),this.clearShow=!1,!1;this.$message.error(o.msg)})},changeGroup(s){if(s){this.form.jobId=0,this.form.jobGroup=s,this.doSearchJob(s);const o=this.executorData.filter(d=>d.id==s);return this.jobGroupName=o?o[0].title:"全部",!1}this.jobGroupName="全部"},async doSearchJob(s){const o=await this.jobInfo.get({jobGroup:s});this.jobData=o==null?void 0:o.data.content,this.form.jobId||(this.form.jobId=this.jobData&&this.jobData.length==1?this.jobData[0].id:0,this.jobName=this.jobData&&this.jobData.length==1?this.jobData[0].jobDesc:void 0)},async intiCharts(){const s={},o=this.$TOOL.date.getDateRang("pastWeek");s.startDate=o[0],s.endDate=o[1],this.$API.scheduler.joblogChart.get(s).then(d=>{var D,a,u,j,n,f,b;if(d.code==="00000"){this.logsChartOption.xAxis.data.length=0,this.logsChartOption.xAxis.data=(D=d.data)==null?void 0:D.content.triggerDayList,this.logsChartOption.series[0].data=(a=d.data)==null?void 0:a.content.triggerDayCountFailList,this.logsChartOption.series[1].data=(u=d.data)==null?void 0:u.content.triggerDayCountRunningList,this.logsChartOption.series[2].data=(j=d.data)==null?void 0:j.content.triggerDayCountSucList,this.logsChartOption2.xAxis.data.length=0;const c=this.logsChartOption.xAxis.data.length;this.logsChartOption2.series[0].data.push({value:(n=d.data)==null?void 0:n.content.triggerDayCountFailList[c-1],name:"失败"}),this.logsChartOption2.series[0].data.push({value:(f=d.data)==null?void 0:f.content.triggerDayCountRunningList[c-1],name:"进行中"}),this.logsChartOption2.series[0].data.push({value:(b=d.data)==null?void 0:b.content.triggerDayCountSucList[c-1],name:"成功"})}})},async initial(){this.intiCharts();const s=await this.jobGroup.get();if(this.executorData=s==null?void 0:s.data.data,!this.form.jobGroup)this.form.jobGroup=this.executorData&&this.executorData.length==1?this.executorData[0].id:0,this.jobGroupName=this.executorData&&this.executorData.length==1?this.executorData[0].title:"";else{const o=this.executorData&&this.executorData.length>0?this.executorData.filter(d=>d.id==this.form.jobGroup):[];o.length>0&&(this.jobGroupName=o[0].title),this.form.jobId&&this.doSearchJob(this.form.jobGroup)}this.search()},search(){this.date&&(this.form.filterTime=this.date.join(" - ")),this.form.jobId||(this.form.jobId=0),this.$refs.table.reload(this.form)},rowClick(s){this.infoDrawer=!0,this.$nextTick(()=>{this.$refs.info.setData(s)})}}},q={class:"left-panel"},K={class:"right-panel"},Q={class:"right-panel-search"},X={style:{float:"left"}},$={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},ee={style:{float:"left"}},te={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},oe={key:0},le={key:1},ae={class:"dialog-footer"};function se(s,o,d,D,a,u){const j=r("el-date-picker"),n=r("el-option"),f=r("el-select"),b=r("el-input"),c=r("el-button"),V=r("el-header"),I=r("scEcharts"),A=r("sc-status-indicator"),N=r("el-icon-info-filled"),L=r("el-icon"),h=r("el-table-column"),w=r("el-tag"),M=r("scTable"),G=r("el-main"),C=r("el-container"),v=r("el-form-item"),U=r("el-form"),R=r("el-dialog"),B=r("info"),E=r("el-drawer"),z=r("cat"),S=Y("time");return i(),_(k,null,[e(C,null,{default:l(()=>[x(` <el-aside width="220px">\r
			<el-tree ref="category" class="menu" node-key="label" :data="category" :default-expanded-keys="['系统日志']"\r
				current-node-key="系统日志" :highlight-current="true" :expand-on-click-node="false">\r
			</el-tree>\r
		</el-aside> `),e(C,null,{default:l(()=>[e(G,{class:"nopadding"},{default:l(()=>[e(C,null,{default:l(()=>[e(V,null,{default:l(()=>[p("div",q,[e(j,{modelValue:a.date,"onUpdate:modelValue":o[0]||(o[0]=t=>a.date=t),"value-format":"YYYY-MM-DD HH:MM:ss",type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),p("div",K,[p("div",Q,[e(f,{modelValue:a.form.logStatus,"onUpdate:modelValue":o[1]||(o[1]=t=>a.form.logStatus=t),filterable:"",style:{width:"100%"}},{default:l(()=>[e(n,{value:0,label:"全部"}),e(n,{value:1,label:"成功"}),e(n,{value:2,label:"失败"}),e(n,{value:3,label:"进行中"})]),_:1},8,["modelValue"]),e(f,{modelValue:a.form.jobGroup,"onUpdate:modelValue":o[2]||(o[2]=t=>a.form.jobGroup=t),filterable:"",style:{width:"100%"},onChange:u.changeGroup},{default:l(()=>[e(n,{value:0,label:"全部"}),(i(!0),_(k,null,O(a.executorData,t=>(i(),m(n,{value:t.id,label:t.appname},{default:l(()=>[p("span",X,y(t.appname),1),p("span",$,y(t.title),1)]),_:2},1032,["value","label"]))),256))]),_:1},8,["modelValue","onChange"]),e(f,{modelValue:a.form.jobId,"onUpdate:modelValue":o[3]||(o[3]=t=>a.form.jobId=t),filterable:"",style:{width:"100%"}},{default:l(()=>[e(n,{value:0,label:"全部"}),(i(!0),_(k,null,O(a.jobData,t=>(i(),m(n,{value:t.id,label:t.jobDesc},{default:l(()=>[p("span",ee,y(t.jobDesc),1),p("span",te,y(t.jobDesc),1)]),_:2},1032,["value","label"]))),256))]),_:1},8,["modelValue"]),e(b,{modelValue:u.search.keyword,"onUpdate:modelValue":o[4]||(o[4]=t=>u.search.keyword=t),placeholder:"关键词",clearable:""},null,8,["modelValue"]),e(c,{type:"primary",icon:"el-icon-search",onClick:u.search},null,8,["onClick"]),e(c,{type:"danger",icon:"el-icon-delete",onClick:u.clear},null,8,["onClick"])])])]),_:1}),e(V,{style:{height:"150px"}},{default:l(()=>[e(I,{height:"100%",option:a.logsChartOption},null,8,["option"]),x(' <scEcharts height="100%" :option="logsChartOption2"></scEcharts> ')]),_:1}),e(G,{class:"nopadding"},{default:l(()=>[e(M,{ref:"table",loading:a.loading,params:a.form,apiObj:a.apiObj,stripe:"",highlightCurrentRow:"",onRowClick:u.rowClick},{default:l(()=>[e(h,{label:"级别",prop:"level",width:"60"},{default:l(t=>[t.row.triggerCode==500?(i(),m(A,{key:0,pulse:"",type:"warning",title:"結果失败"})):(i(),m(L,{key:1,style:{color:"#068f3f"}},{default:l(()=>[e(N)]),_:1}))]),_:1}),e(h,{label:"任务ID",prop:"id",width:"150"}),e(h,{label:"调度时间",prop:"triggerTime",width:"150"},{default:l(t=>[T(p("span",null,null,512),[[S,t.row.triggerTime]])]),_:1}),e(h,{label:"调度结果",prop:"logMapping","show-overflow-tooltip":""},{default:l(t=>[t.row.triggerCode==500?(i(),m(w,{key:0,type:"danger"},{default:l(()=>[g("失败")]),_:1})):(i(),m(w,{key:1,type:"success"},{default:l(()=>[g("成功")]),_:1}))]),_:1}),e(h,{label:"调度备注",prop:"logAddress",width:"150"},{default:l(t=>[e(c,{text:"",type:"primary",size:"small"},{default:l(()=>[g("查看")]),_:1})]),_:1}),e(h,{label:"执行时间",prop:"handleTime"},{default:l(t=>[T(p("span",null,null,512),[[S,t.row.handleTime]])]),_:1}),e(h,{label:"执行结果",prop:"handleCode"},{default:l(t=>[t.row.handleCode!==200?(i(),m(w,{key:0,type:"danger"},{default:l(()=>[g("失败")]),_:1})):(i(),m(w,{key:1,type:"success"},{default:l(()=>[g("成功")]),_:1}))]),_:1}),e(h,{label:"执行备注",prop:"handleMsg",width:"150"},{default:l(t=>[t.row.handleMsg?(i(),_("span",oe,y(t.row.handleMsg),1)):(i(),_("span",le,"无"))]),_:1}),e(h,{label:"操作",prop:"operator",fixed:!1},{default:l(t=>[e(c,{text:"",plain:"",icon:"el-icon-view",title:"详情",style:{"z-index":"999999"},onClick:H(re=>u.doDetail(t.row),["stop"])},null,8,["onClick"])]),_:1}),x(` <el-table-column label="操作" prop="logCost">\r
                                <template #default="scope">\r
                                    <el-badge v-if="scope.row.logCost > 1000">{{ scope.row.logCost }} ms</el-badge>\r
                                    <span v-else>{{ scope.row.logCost }} ms</span>\r
                                </template>\r
                            </el-table-column> `)]),_:1},8,["loading","params","apiObj","onRowClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(R,{title:"日志清理",modelValue:a.clearShow,"onUpdate:modelValue":o[10]||(o[10]=t=>a.clearShow=t),onClose:o[11]||(o[11]=t=>a.clearShow=!1)},{footer:l(()=>[p("span",ae,[e(c,{onClick:o[8]||(o[8]=t=>a.clearShow=!1)},{default:l(()=>[g("取消")]),_:1}),e(c,{type:"primary",onClick:o[9]||(o[9]=t=>u.clearLog(0))},{default:l(()=>[g("确定")]),_:1})])]),default:l(()=>[e(U,{model:a.form,"label-width":"120px"},{default:l(()=>[e(v,{label:"执行器"},{default:l(()=>[e(b,{disabled:"",readonly:"",modelValue:a.jobGroupName,"onUpdate:modelValue":o[5]||(o[5]=t=>a.jobGroupName=t)},null,8,["modelValue"])]),_:1}),e(v,{label:"任务"},{default:l(()=>[e(b,{disabled:"",readonly:"",modelValue:a.jobName,"onUpdate:modelValue":o[6]||(o[6]=t=>a.jobName=t)},null,8,["modelValue"])]),_:1}),e(v,{label:""},{default:l(()=>[e(f,{modelValue:a.clearType,"onUpdate:modelValue":o[7]||(o[7]=t=>a.clearType=t),style:{width:"100%"}},{default:l(()=>[e(n,{label:"清理一个月之前的日志数据",value:1}),e(n,{label:"清理三个月之前的日志数据",value:2}),e(n,{label:"清理六个月之前的日志数据",value:3}),e(n,{label:"清理一年之前的日志数据",value:4}),e(n,{label:"清理一千条之前的日志数据",value:5}),e(n,{label:"清理一万条之前的日志数据",value:6}),e(n,{label:"清理三万条之前的日志数据",value:7}),e(n,{label:"清理十万条之前的日志数据",value:8}),e(n,{label:"清理所以日志数据",value:9})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(E,{modelValue:a.infoDrawer,"onUpdate:modelValue":o[12]||(o[12]=t=>a.infoDrawer=t),title:"日志详情",size:800,"destroy-on-close":""},{default:l(()=>[e(B,{ref:"info"},null,512)]),_:1},8,["modelValue"]),a.catStatus?(i(),m(z,{key:0,ref:"catRef"},null,512)):x("v-if",!0)],64)}const ce=J(Z,[["render",se],["__file","Z:/workspace/vue-support-parent-starter/vue-support-scheduler-starter/src/views/scheduler/joblog/index.vue"]]);export{ce as default};
